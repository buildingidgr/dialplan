"use strict";(()=>{var e={};e.id=975,e.ids=[975],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},346:(e,t,o)=>{o.r(t),o.d(t,{config:()=>u,default:()=>p,routeModule:()=>c});var n={};o.r(n),o.d(n,{default:()=>l});var r=o(802),i=o(153),s=o(249);let{callCIAMToOptOut:a}=o(589);async function l(e,t){if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),"OPTIONS"===e.method){t.status(200).end();return}if("POST"!==e.method){t.status(405).json({error:"Method not allowed"});return}t.setHeader("Content-Type","application/json");try{let{digits:o}=e.body,n=parseInt(e.query.attempt)||1;if(console.log(`Collect webhook called - attempt: ${n}, digits: "${o}"`),!o||""===o)return console.log("No input received, playing no_input.wav"),t.status(200).json({verbs:[{type:"PLAY",fileURL:"https://waymore.io/recordings/no_input.wav",bargeIn:!1}]});if("1"===o)return console.log("Valid opt-out input received, calling CIAM"),await a({digits:o,attempt:n,timestamp:new Date().toISOString(),phoneNumber:e.body.phoneNumber||"unknown"}),t.status(200).json({verbs:[{type:"PLAY",fileURL:"https://waymore.io/recordings/opt_out_confirmed.wav",bargeIn:!1}]});if(1===n)return console.log("Invalid input on first attempt, retrying"),t.status(200).json({verbs:[{type:"PLAY",fileURL:"https://waymore.io/recordings/first_invalid_opt_out.wav",bargeIn:!1},{type:"COLLECT",eventUrl:`${process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:"https://YOUR-VERCEL-APP.vercel.app"}/api/voice/hooks/collect/opt-out?attempt=2`,submitOnHash:!0}]});return console.log("Invalid input on second attempt, ending call"),t.status(200).json({verbs:[{type:"PLAY",fileURL:"https://waymore.io/recordings/second_invalid_opt_out.wav",bargeIn:!1}]})}catch(e){console.error("Error in collect webhook:",e),t.status(500).json({error:"Internal server error"})}}let p=(0,s.l)(n,"default"),u=(0,s.l)(n,"config"),c=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/voice/hooks/collect/opt-out",pathname:"/api/voice/hooks/collect/opt-out",bundlePath:"",filename:""},userland:n})},589:e=>{async function t(e){console.log("Simulated CIAM opt-out call with payload:",e)}e.exports={callCIAMToOptOut:t}},153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../../../../webpack-api-runtime.js");t.C(e);var o=t(t.s=346);module.exports=o})();